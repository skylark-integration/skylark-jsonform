/**
 * skylark-jsonform - A version of jsonform that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsonform/
 * @license MIT
 */
!function(e,t){var n=t.define,require=t.require,i="function"==typeof n&&n.amd,a=!i&&"undefined"!=typeof exports;if(!i&&!n){var l={};n=t.define=function(e,t,n){"function"==typeof n?(l[e]={factory:n,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var n=t.split("/"),i=e.split("/");n.pop();for(var a=0;a<i.length;a++)"."!=i[a]&&(".."==i[a]?n.pop():n.push(i[a]));return n.join("/")}(t,e)}),resolved:!1,exports:null},require(e)):l[e]={factory:null,resolved:!0,exports:n}},require=t.require=function(e){if(!l.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=l[e];if(!module.resolved){var n=[];module.deps.forEach(function(e){n.push(require(e))}),module.exports=module.factory.apply(t,n)||null,module.resolved=!0}return module.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-jsonform/jsonform",["skylark-langx-ns","skylark-jquery"],function(e,t){return e.attach("intg.jsonform",{util:{}})}),e("skylark-jsonform/util",["skylark-langx","./jsonform"],function(e,t){var n=/\[([0-9]*)\](?=\[|\.|$)/g,i=function(t){return!(e.isUndefined(t)||e.isNull(t))};return t.util={fieldTemplateSettings:{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},valueTemplateSettings:{evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g},each:function(t,n){return e.each(t,n,!0)},hasOwnProperty:function(e,t){return"object"==typeof e&&e.hasOwnProperty(t)},escapeSelector:function(e){return e.replace(/([ \!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;<\=\>\?\@\[\\\]\^\`\{\|\}\~])/g,"\\$1")},slugify:function(e){return e.replace(/\ /g,"_")},isSet:i,applyArrayPath:function(e,t){var a=0;return e?t&&0!==t.length?e.replace(n,function(e,n){var l=e;return i(t[a])&&(l="["+t[a]+"]"),a+=1,l}):e:null},getObjKey:function(t,i,a){for(var l=t,r=i.split("."),s=null,o=null,d=null,m=0;m<r.length;m++){if(null===l||"object"!=typeof l)return null;if(s=r[m],d=s.replace(n,""),n.lastIndex=0,o=n.exec(s))for(;;){if(d&&!e.isArray(l[d]))return null;if(l=d?l[d][parseInt(o[1])]:l[parseInt(o[1])],!(o=n.exec(s)))break;d=null}else l=a&&!l[d]&&e.isArray(l)&&l[0]?l[0][d]:l[d]}return a&&e.isArray(l)&&l[0]?l[0]:l},setObjKey:function(t,i,a){for(var l=t,r=i.split("."),s=null,o=null,d=null,m=0;m<r.length-1;m++)if(s=r[m],d=s.replace(n,""),n.lastIndex=0,o=n.exec(s)){for(;e.isArray(l[d])||(l[d]=[]),l=l[d],d=parseInt(o[1],10),o=n.exec(s););"object"==typeof l[d]&&null!==l[d]||(l[d]={}),l=l[d]}else"object"==typeof l[d]&&null!==l[d]||(l[d]={}),l=l[d];if(s=r[r.length-1],d=s.replace(n,""),n.lastIndex=0,o=n.exec(s)){for(;e.isArray(l[d])||(l[d]=[]),l=l[d],d=parseInt(o[1],10),o=n.exec(s););l[d]=a}else l[d]=a},getSchemaKey:function(e,n){var i=n.replace(/\./g,".properties.").replace(/\[[0-9]*\]/g,".items"),a=t.util.getObjKey(e,i,!0);if(a&&a.$ref)throw new Error("JSONForm does not yet support schemas that use the $ref keyword. See: https://github.com/joshfire/jsonform/issues/54");return a},max:function(e){return e.reduce(function(e,t){return Math.max(e,t)})}}}),e("skylark-jsonform/element-types",["skylark-langx","skylark-jquery","./jsonform","./util"],function(e,t,n,i){var a='<div class="_jsonform-preview"><% if (value.type=="image") { %><img class="jsonform-preview" id="jsonformpreview-<%= id %>" src="<%= value.url %>" /><% } else { %><a href="<%= value.url %>"><%= value.name %></a> (<%= Math.ceil(value.size/1024) %>kB)<% } %></div><a href="#" class="btn btn-default _jsonform-delete"><i class="glyphicon glyphicon-remove" title="Remove"></i></a> ',l=function(e){return{template:'<input type="'+e+'" class=\'form-control<%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\'name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.readOnly ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && (node.schemaElement.step > 0 || node.schemaElement.step == "any") ? " step=\'" + node.schemaElement.step + "\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.required && (node.schemaElement.type !== "boolean") ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%> />',fieldtemplate:!0,inputfield:!0}};return n.elementTypes={none:{template:""},root:{template:"<div><%= children %></div>"},text:l("text"),password:l("password"),date:l("date"),datetime:l("datetime"),"datetime-local":l("datetime-local"),email:l("email"),month:l("month"),number:l("number"),search:l("search"),tel:l("tel"),time:l("time"),url:l("url"),week:l("week"),range:{template:'<div class="range"><input type="range" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %>name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%> min=<%= range.min %> max=<%= range.max %> step=<%= range.step %><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %> /><% if (range.indicator) { %><span class="range-value" rel="<%= id %>"><%= escape(value) %></span><% } %></div>',fieldtemplate:!0,inputfield:!0,onInput:function(e,t){const n=document.querySelector('span.range-value[rel="'+t.id+'"]');n&&(n.innerText=e.target.value)},onBeforeRender:function(e,t){e.range={min:1,max:100,step:1,indicator:!1},t&&t.schemaElement&&(t.formElement&&t.formElement.step&&(e.range.step=t.formElement.step),t.formElement&&t.formElement.indicator&&(e.range.indicator=t.formElement.indicator),void 0!==t.schemaElement.minimum&&(t.schemaElement.exclusiveMinimum?e.range.min=t.schemaElement.minimum+e.range.step:e.range.min=t.schemaElement.minimum),void 0!==t.schemaElement.maximum&&(t.schemaElement.exclusiveMaximum?e.range.max=t.schemaElement.maximum-e.range.step:e.range.max=t.schemaElement.maximum))}},color:{template:'<input type="text" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %>name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %> />',fieldtemplate:!0,inputfield:!0,onInsert:function(e,n){t(n.el).find("#"+i.escapeSelector(n.id)).spectrum({preferredFormat:"hex",showInput:!0})}},textarea:{template:'<textarea id="<%= id %>" name="<%= node.name %>" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %>style="height:<%= elt.height || "150px" %>;width:<%= elt.width || "100%" %>;" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.readOnly ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0},wysihtml5:{template:'<textarea id="<%= id %>" name="<%= node.name %>" style="height:<%= elt.height || "300px" %>;width:<%= elt.width || "100%" %>;" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %><%= (node.disabled? " disabled" : "")%><%= (node.readOnly ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,n){var a=function(){t(n.el).data("wysihtml5")||(t(n.el).data("wysihtml5_loaded",!0),t(n.el).find("#"+i.escapeSelector(n.id)).wysihtml5({html:!0,link:!0,"font-styles":!0,image:!1,events:{load:function(){t(this.textareaElement).removeAttr("required")}}}))};if(window.jsonform_wysihtml5_setup)window.jsonform_wysihtml5_setup(a);else var l=window.setInterval(function(){window.wysihtml5&&(window.clearInterval(l),a())},1e3)}},ace:{template:'<div id="<%= id %>" style="position:relative;height:<%= elt.height || "300px" %>;"><div id="<%= id %>__ace" style="width:<%= elt.width || "100%" %>;height:<%= elt.height || "300px" %>;"></div><input type="hidden" name="<%= node.name %>" id="<%= id %>__hidden" value="<%= escape(value) %>"/></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(n,a){var l=function(){var n=a.formElement||{},l=window.ace,r=l.edit(t(a.el).find("#"+i.escapeSelector(a.id)+"__ace").get(0)),s="#"+i.escapeSelector(a.id)+"__hidden";r.getSession().setNewLineMode("unix"),r.renderer.setShowPrintMargin(!1),r.setTheme("ace/theme/"+(n.aceTheme||"twilight")),n.aceMode&&r.getSession().setMode("ace/mode/"+n.aceMode),r.getSession().setTabSize(2),r.getSession().setValue(a.value||"");var o=e.debounce(function(){t(a.el).find(s).val(r.getSession().getValue()),t(a.el).find(s).change()},600);r.getSession().on("change",o),r.on("blur",function(){t(a.el).find(s).change(),t(a.el).find(s).trigger("blur")}),r.on("focus",function(){t(a.el).find(s).trigger("focus")})};if(window.jsonform_ace_setup)window.jsonform_ace_setup(l);else var r=window.setInterval(function(){window.ace&&(window.clearInterval(r),l())},1e3)}},checkbox:{template:'<div class="checkbox"><label><input type="checkbox" id="<%= id %>" <%= (fieldHtmlClass ? " class=\'" + fieldHtmlClass + "\'": "") %>name="<%= node.name %>" value="1" <% if (value) {%>checked<% } %><%= (node.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required && (node.schemaElement.type !== "boolean") ? " required=\'required\'" : "") %> /><%= node.inlinetitle || "" %></label></div>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return t(e).parent().get(0)}},file:{template:'<input class="input-file" id="<%= id %>" name="<%= node.name %>" type="file" <%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %><%= (node.formElement && node.formElement.accept ? (" accept=\'" + node.formElement.accept + "\'") : "") %>/>',fieldtemplate:!0,inputfield:!0},"file-hosted-public":{template:"<span><% if (value && (value.type||value.url)) { %>"+a+'<% } %><input class="input-file" id="_transloadit_<%= id %>" type="file" name="<%= transloaditname %>" /><input data-transloadit-name="_transloadit_<%= transloaditname %>" type="hidden" id="<%= id %>" name="<%= node.name %>" value=\'<%= escape(JSON.stringify(node.value)) %>\' /></span>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return t(e).parent().get(0)},onBeforeRender:function(e,t){t.ownerTree._transloadit_generic_public_index?t.ownerTree._transloadit_generic_public_index++:t.ownerTree._transloadit_generic_public_index=1,e.transloaditname="_transloadit_jsonform_genericupload_public_"+t.ownerTree._transloadit_generic_public_index,t.ownerTree._transloadit_generic_elts||(t.ownerTree._transloadit_generic_elts={}),t.ownerTree._transloadit_generic_elts[e.transloaditname]=t},onChange:function(n,a){if(a.ownerTree._transloadit_bound)return!1;a.ownerTree._transloadit_bound=!0;var l=t(a.ownerTree.domRoot);l.transloadit({autoSubmit:!1,wait:!0,onSuccess:function(t){var n=e.values(t.results);n=e.flatten(n),i.each(n,function(t){var n=a.ownerTree._transloadit_generic_elts[t.field].id,r=l.find("#"+i.escapeSelector(n)),s=e.filter(e.keys(t.meta),function(e){return!!i.isSet(t.meta[e])});t.meta=e.pick(t.meta,s),r.val(JSON.stringify(t))}),a.ownerTree._transloadit_bound=!1,l.unbind("submit.transloadit"),e.defer(function(){a.ownerTree.submit()},10)},onError:function(e){console.log("assembly error",e)}})},onInsert:function(e,n){t(n.el).find("a._jsonform-delete").on("click",function(e){return t(n.el).find("._jsonform-preview").remove(),t(n.el).find("a._jsonform-delete").remove(),t(n.el).find("#"+i.escapeSelector(n.id)).val(""),e.preventDefault(),!1})},onSubmit:function(e,t){return!t.ownerTree._transloadit_bound}},"file-transloadit":{template:"<span><% if (value && (value.type||value.url)) { %>"+a+'<% } %><input class="input-file" id="_transloadit_<%= id %>" type="file" name="_transloadit_<%= node.name %>" /><input type="hidden" id="<%= id %>" name="<%= node.name %>" value=\'<%= escape(JSON.stringify(node.value)) %>\' /></span>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return t(e).parent().get(0)},onChange:function(n,a){if(a.ownerTree._transloadit_bound)return!1;a.ownerTree._transloadit_bound=!0;var l=t(a.ownerTree.domRoot);l.transloadit({autoSubmit:!1,wait:!0,onSuccess:function(t){var n=e.values(t.results);n=e.flatten(n),i.each(n,function(t){var n=l.find('input[name="'+t.field.replace(/^_transloadit_/,"")+'"]'),a=e.filter(e.keys(t.meta),function(e){return!!i.isSet(t.meta[e])});t.meta=e.pick(t.meta,a),n.val(JSON.stringify(t))}),a.ownerTree._transloadit_bound=!1,l.unbind("submit.transloadit"),e.defer(function(){a.ownerTree.submit()},10)},onError:function(e){console.log("assembly error",e)}})},onInsert:function(e,n){t(n.el).find("a._jsonform-delete").on("click",function(e){return t(n.el).find("._jsonform-preview").remove(),t(n.el).find("a._jsonform-delete").remove(),t(n.el).find("#"+i.escapeSelector(n.id)).val(""),e.preventDefault(),!1})},onSubmit:function(e,t){return!t.ownerTree._transloadit_bound}},select:{template:'<select name="<%= node.name %>" id="<%= id %>"class=\'form-control<%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\'<%= (node.schemaElement && node.schemaElement.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %>> <% _.forEach(node.options, function(key, val) { if(key instanceof Object) { if (value === key.value) { %> <option selected value="<%= key.value %>"><%= key.title %></option> <% } else { %> <option value="<%= key.value %>"><%= key.title %></option> <% }} else { if (value === key) { %> <option selected value="<%= key %>"><%= key %></option> <% } else { %><option value="<%= key %>"><%= key %></option> <% }}}); %> </select>',fieldtemplate:!0,inputfield:!0},imageselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="btn<% if (buttonClass && node.value) { %> <%= buttonClass %><% } else { %> btn-default<% } %>" data-toggle="dropdown" href="#"<% if (node.value) { %> style="max-width:<%= width %>px;max-height:<%= height %>px"<% } %>><% if (node.value) { %><img src="<% if (!node.value.match(/^https?:/)) { %><%= prefix %><% } %><%= node.value %><%= suffix %>" alt="" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu navbar" id="<%= node.id %>_dropdown"><div><% _.forEach(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="btn<% if (buttonClass) { %> <%= buttonClass %><% } else { %> btn-default<% } %>" style="max-width:<%= width %>px;max-height:<%= height %>px"><% if (key instanceof Object) { %><img src="<% if (!key.value.match(/^https?:/)) { %><%= prefix %><% } %><%= key.value %><%= suffix %>" alt="<%= key.title %>" /></a><% } else { %><img src="<% if (!key.match(/^https?:/)) { %><%= prefix %><% } %><%= key %><%= suffix %>" alt="" /><% } %></a> <% }); %></div><div class="pagination-right"><a class="btn btn-default">Reset</a></div></div></div></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var n=t.formElement||{},i=null,a=n.imageSelectorColumns||5;e.buttonTitle=n.imageSelectorTitle||"Select...",e.prefix=n.imagePrefix||"",e.suffix=n.imageSuffix||"",e.width=n.imageWidth||32,e.height=n.imageHeight||32,e.buttonClass=n.imageButtonClass||!1,t.options.length>a?(i=Math.ceil(t.options.length/a),e.columns=Math.ceil(t.options.length/i)):e.columns=a},getElement:function(e){return t(e).parent().get(0)},onInsert:function(e,n){t(n.el).on("click",".dropdown-menu a",function(e){e.preventDefault(),e.stopPropagation();var i="img"===e.target.nodeName.toLowerCase()?t(e.target):t(e.target).find("img"),a=i.attr("src"),l=n.formElement||{},r=l.imagePrefix||"",s=l.imageSuffix||"",o=l.imageWidth||32,d=l.imageHeight||32;a?(0===a.indexOf(r)&&(a=a.substring(r.length)),a=a.substring(0,a.length-s.length),t(n.el).find("input").attr("value",a),t(n.el).find('a[data-toggle="dropdown"]').addClass(l.imageButtonClass).attr("style","max-width:"+o+"px;max-height:"+d+"px").html('<img src="'+(a.match(/^https?:/)?"":r)+a+s+'" alt="" />')):(t(n.el).find("input").attr("value",""),t(n.el).find('a[data-toggle="dropdown"]').removeClass(l.imageButtonClass).removeAttr("style").html(l.imageSelectorTitle||"Select..."))})}},iconselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="btn<% if (buttonClass && node.value) { %> <%= buttonClass %><% } %>" data-toggle="dropdown" href="#"<% if (node.value) { %> style="max-width:<%= width %>px;max-height:<%= height %>px"<% } %>><% if (node.value) { %><i class="icon-<%= node.value %>" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu navbar" id="<%= node.id %>_dropdown"><div><% _.forEach(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="btn<% if (buttonClass) { %> <%= buttonClass %><% } %>" ><% if (key instanceof Object) { %><i class="icon-<%= key.value %>" alt="<%= key.title %>" /></a><% } else { %><i class="icon-<%= key %>" alt="" /><% } %></a> <% }); %></div><div class="pagination-right"><a class="btn">Reset</a></div></div></div></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var n=t.formElement||{},i=null,a=n.imageSelectorColumns||5;e.buttonTitle=n.imageSelectorTitle||"Select...",e.buttonClass=n.imageButtonClass||!1,t.options.length>a?(i=Math.ceil(t.options.length/a),e.columns=Math.ceil(t.options.length/i)):e.columns=a},getElement:function(e){return t(e).parent().get(0)},onInsert:function(e,n){t(n.el).on("click",".dropdown-menu a",function(e){e.preventDefault(),e.stopPropagation();var i="i"===e.target.nodeName.toLowerCase()?t(e.target):t(e.target).find("i"),a=i.attr("class"),l=n.formElement||{};a?(a=a,t(n.el).find("input").attr("value",a),t(n.el).find('a[data-toggle="dropdown"]').addClass(l.imageButtonClass).html('<i class="'+a+'" alt="" />')):(t(n.el).find("input").attr("value",""),t(n.el).find('a[data-toggle="dropdown"]').removeClass(l.imageButtonClass).html(l.imageSelectorTitle||"Select..."))})}},radios:{template:'<div id="<%= node.id %>"><% _.forEach(node.options, function(key, val) { %><div class="radio"><label><input<%= (fieldHtmlClass ? " class=\'" + fieldHtmlClass + "\'": "") %> type="radio" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %> checked="checked" <% } %> name="<%= node.name %>" value="<%= (key instanceof Object ? key.value : key) %>"<%= (node.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %>/><%= (key instanceof Object ? key.title : key) %></label></div> <% }); %></div>',fieldtemplate:!0,inputfield:!0},radiobuttons:{template:'<div id="<%= node.id %>"><% _.forEach(node.options, function(key, val) { %><label class="btn btn-default <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %>active btn-success<% } %>"><input<%= (fieldHtmlClass ? " class=\'" + fieldHtmlClass + "\'": "") %> type="radio" style="position:absolute;left:-9999px;" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %> checked="checked" <% } %> name="<%= node.name %>" value="<%= (key instanceof Object ? key.value : key) %>" /><span><%= (key instanceof Object ? key.title : key) %></span></label> <% }); %></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,n){var i="active",a=n.formElement||{};a.activeClass&&(i+=" "+a.activeClass),t(n.el).find("label").on("click",function(){t(this).parent().find("label").removeClass(i),t(this).addClass(i)})}},checkboxes:{template:"<div><%= choiceshtml %></div>",fieldtemplate:!0,inputfield:!0,onBeforeRender:function(t,n){var a=null,l=null;n&&n.schemaElement&&(a=n.schemaElement.items?n.schemaElement.items.enum||n.schemaElement.items[0].enum:n.schemaElement.enum)&&(l="",i.each(a,function(t,a){l+=e.template('<div class="checkbox"><label><input type="checkbox" <% if (value) { %> checked="checked" <% } %> name="<%= name %>" value="1"<%= (node.disabled? " disabled" : "")%>/><%= title %></label></div>',i.fieldTemplateSettings)({name:n.key+"["+a+"]",value:e.contains(n.value,t),title:i.hasOwnProperty(n.formElement.titleMap,t)?n.formElement.titleMap[t]:t,node:n})}),t.choiceshtml=l)}},array:{template:'<div id="<%= id %>"><ul class="_jsonform-array-ul" style="list-style-type:none;"><%= children %></ul><span class="_jsonform-array-buttons"><a href="#" class="btn btn-default _jsonform-array-addmore"><i class="glyphicon glyphicon-plus-sign" title="Add new"></i></a> <a href="#" class="btn btn-default _jsonform-array-deletelast"><i class="glyphicon glyphicon-minus-sign" title="Delete last"></i></a></span></div>',fieldtemplate:!0,array:!0,childTemplate:function(e,n){return t("").sortable?'<li data-idx="<%= node.childPos %>">'+(n?'<span class="draggable line"><i class="glyphicon glyphicon-list" title="Move item"></i></span>':"")+e+"</li>":'<li data-idx="<%= node.childPos %>">'+e+"</li>"},onInsert:function(e,n){var a=t(n.el).find("#"+i.escapeSelector(n.id)),l=n.getArrayBoundaries();t("> span > a._jsonform-array-addmore",a).click(function(e){e.preventDefault(),e.stopPropagation();var i=n.children.length;if(l.maxItems>=0&&(n.children.length>l.maxItems-2&&a.find("> span > a._jsonform-array-addmore").addClass("disabled"),n.children.length>l.maxItems-1))return!1;n.insertArrayItem(i,t("> ul",a).get(0)),(l.minItems<=0||l.minItems>0&&n.children.length>l.minItems-1)&&a.find("> span > a._jsonform-array-deletelast").removeClass("disabled")});var r=t("> ul > li",a).length;if(l.minItems>0&&r<l.minItems)for(var s=0;s<l.minItems-1&&a.find("> ul > li").length<l.minItems;s++)n.insertArrayItem(r,a.find("> ul").get(0));l.minItems>0&&n.children.length<=l.minItems&&a.find("> span > a._jsonform-array-deletelast").addClass("disabled"),t("> span > a._jsonform-array-deletelast",a).click(function(e){var t=n.children.length-1;if(e.preventDefault(),e.stopPropagation(),l.minItems>0){if(n.children.length<l.minItems+2&&a.find("> span > a._jsonform-array-deletelast").addClass("disabled"),n.children.length<=l.minItems)return!1}else 1===n.children.length&&a.find("> span > a._jsonform-array-deletelast").addClass("disabled");n.deleteArrayItem(t),l.maxItems>=0&&t<=l.maxItems-1&&a.find("> span > a._jsonform-array-addmore").removeClass("disabled")}),i.isSet(n.formElement.draggable)&&!n.formElement.draggable||t(n.el).sortable&&(t("> ul",a).sortable(),t("> ul",a).bind("sortstop",function(e,i){var l=t(i.item).data("idx"),r=t(i.item).index();!function(e,i){if(e===i)return;var l=e<i?1:-1,r=0,s=t("> ul",a);for(r=e;r!==i;r+=l)n.children[r].switchValuesWith(n.children[r+l]),n.children[r].render(s.get(0)),n.children[r+l].render(s.get(0));var o=t(n.children[e].el),d=t(n.children[i].el);o.detach(),d.detach(),e<i?(0===e?s.prepend(o):t(n.children[e-1].el).after(o),t(n.children[i-1].el).after(d)):(0===i?s.prepend(d):t(n.children[i-1].el).after(d),t(n.children[e-1].el).after(o))}(l,r)}))}},tabarray:{template:'<div id="<%= id %>"><div class="tabbable tabs-left"><ul class="nav nav-tabs"><%= tabs %></ul><div class="tab-content"><%= children %></div></div><a href="#" class="btn btn-default _jsonform-array-addmore"><i class="glyphicon glyphicon-plus-sign" title="Add new"></i></a> <a href="#" class="btn btn-default _jsonform-array-deleteitem"><i class="glyphicon glyphicon-minus-sign" title="Delete item"></i></a></div>',fieldtemplate:!0,array:!0,childTemplate:function(e){return'<div data-idx="<%= node.childPos %>" class="tab-pane">'+e+"</div>"},onBeforeRender:function(t,n){var a="";i.each(n.children,function(t,n){var i=t.legend||t.title||"Item "+(n+1);a+='<li data-idx="'+n+'"'+(0===n?' class="active"':"")+'><a class="draggable tab" data-toggle="tab" rel="'+escape(i)+'">'+e.escapeHTML(i)+"</a></li>"}),t.tabs=a},onInsert:function(n,a){var l=t(a.el).find("#"+i.escapeSelector(a.id)),r=a.getArrayBoundaries(),s=function(n){var r="",s=!1;void 0===n&&((n=t("> .tabbable > .nav-tabs .active",l).data("idx"))?n=parseInt(n,10):(s=!0,n=0)),n>=a.children.length&&(n=a.children.length-1),i.each(a.children,function(n,i){t('> .tabbable > .tab-content > [data-idx="'+i+'"] > fieldset > legend',l).html(n.legend);var a=n.legend||n.title||"Item "+(i+1);r+='<li data-idx="'+i+'"><a class="draggable tab" data-toggle="tab" rel="'+escape(a)+'">'+e.escapeHTML(a)+"</a></li>"}),t("> .tabbable > .nav-tabs",l).html(r),s&&t('> .tabbable > .nav-tabs [data-idx="0"]',l).addClass("active"),t('> .tabbable > .nav-tabs [data-toggle="tab"]',l).eq(n).click()};if(t("> a._jsonform-array-deleteitem",l).click(function(e){var n=Number(t("> .tabbable > .nav-tabs .active",l).data("idx"));if(e.preventDefault(),e.stopPropagation(),r.minItems>0&&(a.children.length<r.minItems+1&&l.find("> a._jsonform-array-deleteitem").addClass("disabled"),a.children.length<=r.minItems))return!1;a.deleteArrayItem(n),s(),(a.children.length<r.minItems+1||0===a.children.length)&&l.find("> a._jsonform-array-deleteitem").addClass("disabled"),r.maxItems>=0&&a.children.length<=r.maxItems&&l.find("> a._jsonform-array-addmore").removeClass("disabled")}),t("> a._jsonform-array-addmore",l).click(function(e){var n=a.children.length;if(r.maxItems>=0&&(a.children.length>r.maxItems-2&&t("> a._jsonform-array-addmore",l).addClass("disabled"),a.children.length>r.maxItems-1))return!1;e.preventDefault(),e.stopPropagation(),a.insertArrayItem(n,l.find("> .tabbable > .tab-content").get(0)),s(n),(r.minItems<=0||r.minItems>0&&n>r.minItems-1)&&l.find("> a._jsonform-array-deleteitem").removeClass("disabled")}),t(a.el).on("legendUpdated",function(e){s(),e.preventDefault(),e.stopPropagation()}),i.isSet(a.formElement.draggable)&&!a.formElement.draggable||t(a.el).sortable&&(t("> .tabbable > .nav-tabs",l).sortable({containment:a.el,tolerance:"pointer"}),t("> .tabbable > .nav-tabs",l).bind("sortstop",function(e,n){var i=t(n.item).data("idx"),r=t(n.item).index();!function(e,n){if(e===n)return;var i=e<n?1:-1,r=0,s=t("> .tabbable > .tab-content",l).get(0);for(r=e;r!==n;r+=i)a.children[r].switchValuesWith(a.children[r+i]),a.children[r].render(s),a.children[r+i].render(s)}(i,r),s(r)})),r.minItems>=0&&a.children.length<=r.minItems){for(var o=0;o<r.minItems-1;o++)l.find("> a._jsonform-array-addmore").click();l.find("> a._jsonform-array-deleteitem").addClass("disabled"),s()}r.maxItems>=0&&a.children.length>=r.maxItems&&l.find("> a._jsonform-array-addmore").addClass("disabled"),r.minItems>=0&&a.children.length<=r.minItems&&l.find("> a._jsonform-array-deleteitem").addClass("disabled")}},help:{template:'<span class="help-block" style="padding-top:5px"><%= elt.helpvalue %></span>',fieldtemplate:!0},msg:{template:"<%= elt.msg %>"},fieldset:{template:'<fieldset class="form-group jsonform-error-<%= keydash %> <% if (elt.expandable) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:"" %>" <% if (id) { %> id="<%= id %>"<% } %>><% if (node.title || node.legend) { %><legend role="treeitem" aria-expanded="false"><%= node.title || node.legend %></legend><% } %><% if (elt.expandable) { %><div class="form-group"><% } %><%= children %><% if (elt.expandable) { %></div><% } %></fieldset>',onInsert:function(e,n){null!==n.el&&(t(".expandable > div, .expandable > fieldset",n.el).hide(),t(".expandable",n.el).removeClass("expanded"))}},advancedfieldset:{template:'<fieldset<% if (id) { %> id="<%= id %>"<% } %> class="expandable <%= elt.htmlClass?elt.htmlClass:"" %>"><legend role="treeitem" aria-expanded="false"><%= (node.title || node.legend) ? (node.title || node.legend) : "Advanced options" %></legend><div class="form-group"><%= children %></div></fieldset>',onInsert:function(e,n){null!==n.el&&(t(".expandable > div, .expandable > fieldset",n.el).hide(),t(".expandable",n.el).removeClass("expanded"))}},authfieldset:{template:'<fieldset<% if (id) { %> id="<%= id %>"<% } %> class="expandable <%= elt.htmlClass?elt.htmlClass:"" %>"><legend role="treeitem" aria-expanded="false"><%= (node.title || node.legend) ? (node.title || node.legend) : "Authentication settings" %></legend><div class="form-group"><%= children %></div></fieldset>',onInsert:function(e,n){null!==n.el&&(t(".expandable > div, .expandable > fieldset",n.el).hide(),t(".expandable",n.el).removeClass("expanded"))}},submit:{template:'<input type="submit" <% if (id) { %> id="<%= id %>" <% } %> class="btn btn-primary <%= elt.htmlClass?elt.htmlClass:"" %>" value="<%= value || node.title %>"<%= (node.disabled? " disabled" : "")%>/>'},button:{template:' <button type="button" <% if (id) { %> id="<%= id %>" <% } %> class="btn btn-default <%= elt.htmlClass?elt.htmlClass:"" %>"><%= node.title %></button> '},actions:{template:'<div class="<%= elt.htmlClass?elt.htmlClass:"" %>"><%= children %></div>'},hidden:{template:'<input type="hidden" id="<%= id %>" name="<%= node.name %>" value="<%= escape(value) %>" />',inputfield:!0},tabs:{template:'<ul class="nav nav-tabs <%= elt.htmlClass?elt.htmlClass:"" %>"<% if (elt.id) { %> id="<%= elt.id %>"<% } %>><%=tab_list%></ul><div class="tab-content" <% if (elt.id) { %> data-tabset="<%= elt.id %>"<% } %>><%=children%></div>',getElement:function(e){return t(e).parent().get(0)},onBeforeRender:function(t,n){var a=e.escapeHTML(n.id?n.id+"-":""),l="";return i.each(n.children,function(t,n){var i=e.escapeHTML(t.title||"Item "+(n+1)),r=i.replace(" ","_");l+='<li class="nav-item'+(0===n?" active":"")+'"><a href="#'+a+r+'" class="nav-link" data-tab="'+a+r+'" data-toggle="tab">'+i+"</a></li>"}),t.tab_list=l,t},onInsert:function(e,n){t("#"+n.id+">li.nav-item").on("click",function(e){e.preventDefault(),t(n.el).find("div[data-tabset='"+n.id+"']>div.tab-pane.active").each(function(){t(this).removeClass("active")});var i=t(this).find("a").attr("data-tab");t("#"+i).addClass("active")})}},tab:{template:'<div class="tab-pane<% if (elt.htmlClass) { %> <%= elt.htmlClass %> <% } %><% if (node.childPos === 0) { %> active<% } %>"<% if (node.title) { %> id="<%= node.parentNode.id %>-<%= node.title.replace(" ","_") %>"<% } %>><%= children %></div>'},selectfieldset:{template:'<fieldset class="tab-container <%= elt.htmlClass?elt.htmlClass:"" %>"><% if (node.legend) { %><legend role="treeitem" aria-expanded="false"><%= node.legend %></legend><% } %><% if (node.formElement.key) { %><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><% } else { %><a id="<%= node.id %>"></a><% } %><div class="tabbable"><div class="form-group<%= node.formElement.hideMenu ? " hide" : "" %>"><% if (!elt.notitle) { %><label for="<%= node.id %>"><%= node.title ? node.title : node.name %></label><% } %><div class="controls"><%= tabs %></div></div><div class="tab-content"><%= children %></div></div></fieldset>',inputfield:!0,getElement:function(e){return t(e).parent().get(0)},childTemplate:function(e){return'<div data-idx="<%= node.childPos %>" class="tab-pane<% if (node.active) { %> active<% } %>">'+e+"</div>"},onBeforeRender:function(t,n){var a=null,l=[];n.schemaElement&&(l=n.schemaElement.enum||[]),a=n.options?e.map(n.options,function(t,a){var r=n.children[a];return r.childPos=a,t instanceof Object?((t=e.extend({node:r},t)).title=t.title||r.legend||r.title||"Option "+(r.childPos+1),t.value=i.isSet(t.value)?t.value:i.isSet(l[a])?l[a]:a,t):{title:t,value:i.isSet(l[r.childPos])?l[r.childPos]:r.childPos,node:r}}):e.map(n.children,function(e,t){return e.childPos=t,{title:e.legend||e.title||"Option "+(e.childPos+1),value:l[e.childPos]||e.childPos,node:e}}),i.each(a,function(e,t){e.node.active=!1});var r=null;t.value&&(r=e.find(a,function(e){return e.value===n.value})),r||(r=e.find(a,function(e){return e.node.hasNonDefaultValue()})),r||(r=a[0]),r.node.active=!0,t.value=r.value;n.formElement;var s='<select class="nav form-control"'+(n.disabled?" disabled":"")+">";return i.each(a,function(t,n){s+='<option data-idx="'+n+'" value="'+t.value+'"'+(t.node.active?' selected="selected" class="active"':"")+">"+e.escapeHTML(t.title)+"</option>"}),s+="</select>",t.tabs=s,t},onInsert:function(e,n){t(n.el).find("select.nav").first().on("change",function(e){var i=t(this).find("option:selected");t(n.el).find('input[type="hidden"]').first().val(i.attr("value"))})}},optionfieldset:{template:'<div<% if (node.id) { %> id="<%= node.id %>"<% } %>><%= children %></div>'},section:{template:'<div<% if (elt.htmlClass) { %> class="<%= elt.htmlClass %>"<% } %><% if (node.id) { %> id="<%= node.id %>"<% } %>><%= children %></div>'},questions:{template:'<div><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><%= children %></div>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return t(e).parent().get(0)},onInsert:function(e,n){n.children&&0!==n.children.length&&(i.each(n.children,function(e){t(e.el).hide()}),t(n.children[0].el).show())}},question:{template:'<div id="<%= node.id %>"><% _.forEach(node.options, function(key, val) { %><label class="<%= (node.formElement.optionsType === "radiobuttons") ? "btn btn-default" : "" %><%= ((key instanceof Object && key.htmlClass) ? " " + key.htmlClass : "") %>"><input type="radio" <% if (node.formElement.optionsType === "radiobuttons") { %> style="position:absolute;left:-9999px;" <% } %>name="<%= node.id %>" value="<%= val %>"<%= (node.disabled? " disabled" : "")%>/><span><%= (key instanceof Object ? key.title : key) %></span></label> <% }); %></div>',fieldtemplate:!0,onInsert:function(n,i){var a="active",l=i.formElement||{};l.activeClass&&(a+=" "+l.activeClass),t(i.el).find('input[type="radio"]').on("change",function(n){var l=null,r=i.options[t(this).val()];i.parentNode&&i.parentNode.el&&(t(this).parent().parent().find("label").removeClass(a),t(this).parent().addClass(a),t(i.el).nextAll().hide(),t(i.el).nextAll().find('input[type="radio"]').prop("checked",!1),r.value&&t(i.parentNode.el).find('input[type="hidden"]').val(r.value),r.next&&(l=e.find(i.parentNode.children,function(e){return e.formElement&&e.formElement.qid===r.next}),t(l.el).show(),t(l.el).nextAll().hide(),t(l.el).nextAll().find('input[type="radio"]').prop("checked",!1)),r.href&&(r.target?window.open(r.href,r.target):window.location=r.href),r.submit&&setTimeout(function(){i.ownerTree.submit()},0))})}}},n.elementTypes}),e("skylark-jsonform/field-template",["./jsonform"],function(e){return e.fieldTemplate=function(e){return'<div <% for(var key in elt.htmlMetaData) {%><%= key %>="<%= elt.htmlMetaData[key] %>" <% }%>class="form-group jsonform-error-<%= keydash %><%= elt.htmlClass ? " " + elt.htmlClass : "" %><%= (node.schemaElement && node.schemaElement.required && (node.schemaElement.type !== "boolean") ? " jsonform-required" : "") %><%= (node.readOnly ? " jsonform-readonly" : "") %><%= (node.disabled ? " jsonform-disabled" : "") %>"><% if (!elt.notitle) { %><label for="<%= node.id %>"><%= node.title ? node.title : node.name %></label><% } %><div class="controls"><% if (node.prepend || node.append) { %><div class="<% if (node.prepend) { %>input-group<% } %><% if (node.append) { %> input-group<% } %>"><% if (node.prepend) { %><span class="input-group-addon"><%= node.prepend %></span><% } %><% } %>'+e+'<% if (node.append) { %><span class="input-group-addon"><%= node.append %></span><% } %><% if (node.prepend || node.append) { %></div><% } %><% if (node.description) { %><span class="help-block"><%= node.description %></span><% } %><span class="help-block jsonform-errortext" style="display:none;"></span></div></div>'}}),e("skylark-jsonform/form-node",["skylark-langx-types","skylark-langx-objects","skylark-langx-funcs","skylark-langx-arrays","skylark-langx-strings","skylark-langx","skylark-jquery","./jsonform","./util"],function(e,t,n,i,a,l,r,s,o){var d=function(){this.id=null,this.key=null,this.el=null,this.formElement=null,this.schemaElement=null,this.view=null,this.children=[],this.ownerTree=null,this.parentNode=null,this.childTemplate=null,this.legendChild=null,this.arrayPath=[],this.childPos=0};return d.prototype.clone=function(e){var n=new d;return n.arrayPath=t.clone(this.arrayPath),n.ownerTree=this.ownerTree,n.parentNode=e||this.parentNode,n.formElement=this.formElement,n.schemaElement=this.schemaElement,n.view=this.view,n.children=i.map(this.children,function(e){return e.clone(n)}),this.childTemplate&&(n.childTemplate=this.childTemplate.clone(n)),n},d.prototype.hasNonDefaultValue=function(){if(this.formElement&&"hidden"==this.formElement.type)return!1;if(this.value&&!this.defaultValue)return!0;var e=this.children.find(function(e){return e.hasNonDefaultValue()});return!!e},d.prototype.appendChild=function(e){return e.parentNode=this,e.childPos=this.children.length,this.children.push(e),e},d.prototype.removeChild=function(){var e=this.children[this.children.length-1];if(e)return r(e.el).remove(),this.children.pop()},d.prototype.moveValuesTo=function(e){var t=this.getFormValues(e.arrayPath);e.resetValues(),e.computeInitialValues(t,!0)},d.prototype.switchValuesWith=function(e){var t=this.getFormValues(e.arrayPath),n=e.getFormValues(this.arrayPath);e.resetValues(),e.computeInitialValues(t,!0),this.resetValues(),this.computeInitialValues(n,!0)},d.prototype.resetValues=function(){var e=null;if(this.value=null,this.parentNode?(this.arrayPath=t.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],this.view&&this.view.inputfield)e=r(":input",this.el).serializeArray(),o.each(e,function(e){r('[name="'+o.escapeSelector(e.name)+'"]',r(this.el)).val("")},this);else if(this.view&&this.view.array)for(;this.children.length>0;)this.removeChild();o.each(this.children,function(e){e.resetValues()})},d.prototype.setChildTemplate=function(e){this.childTemplate=e,e.parentNode=this},d.prototype.computeInitialValues=function(n,r){var s=this,d=null,m=1,h=0,c=this.ownerTree.formDesc.tpldata||{};if(this.parentNode?(this.arrayPath=t.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],c.idx=this.arrayPath.length>0?this.arrayPath[this.arrayPath.length-1]+1:this.childPos+1,c.value="",c.getValue=function(e){if(!n)return"";var t,i=n,a=e.split("[].");for(t=0;t<a.length-1;t++)i=i[a[t]][s.arrayPath[t]];return i[a[t]]},this.formElement&&(this.formElement.id?this.id=o.applyArrayPath(this.formElement.id,this.arrayPath):this.view&&this.view.array?this.id=o.escapeSelector(this.ownerTree.formDesc.prefix)+"-elt-counter-"+a.uniqueId():this.parentNode&&this.parentNode.view&&this.parentNode.view.array?this.id=o.escapeSelector(this.ownerTree.formDesc.prefix)+"-elt-counter-"+a.uniqueId():"button"!==this.formElement.type&&"selectfieldset"!==this.formElement.type&&"question"!==this.formElement.type&&"buttonquestion"!==this.formElement.type||(this.id=o.escapeSelector(this.ownerTree.formDesc.prefix)+"-elt-counter-"+a.uniqueId()),this.formElement.key&&(this.key=o.applyArrayPath(this.formElement.key,this.arrayPath),this.keydash=o.slugify(this.key.replace(/\./g,"---"))),this.name=o.applyArrayPath(this.formElement.name,this.arrayPath),o.each(["title","legend","description","append","prepend","inlinetitle","helpvalue","value","disabled","placeholder","readOnly"],t=>{e.isString(this.formElement[t])?(-1!==this.formElement[t].indexOf("{{values.")?this[t]=this.formElement[t].replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):this[t]=o.applyArrayPath(this.formElement[t],this.arrayPath),this[t]&&(this[t]=l.template(this[t],o.valueTemplateSettings)(c))):this[t]=this.formElement[t]}),this.formElement.options&&(this.options=i.map(this.formElement.options,function(n){var i=null;return e.isObject(n)&&n.title?(i=-1!==n.title.indexOf("{{values.")?n.title.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):o.applyArrayPath(n.title,s.arrayPath),t.extend({},n,{value:o.isSet(n.value)?n.value:"",title:l.template(i,o.valueTemplateSettings)(c)})):n}))),this.view&&this.view.inputfield&&this.schemaElement)n?o.isSet(o.getObjKey(n,this.key))?this.value=o.getObjKey(n,this.key):o.isSet(this.schemaElement.default)&&(this.value=this.schemaElement.default,"string"==typeof this.value&&(this.value=l.template(this.value,o.valueTemplateSettings)(c))):r||!o.isSet(this.value)&&o.isSet(this.schemaElement.default)&&(this.value=this.schemaElement.default,e.isString(this.value)&&(-1!==this.value.indexOf("{{values.")?this.value=this.value.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):this.value=o.applyArrayPath(this.value,this.arrayPath),this.value&&(this.value=l.template(this.value,o.valueTemplateSettings)(c))),this.defaultValue=!0);else if(this.view&&this.view.array)for(m=0,n?m=this.getPreviousNumberOfItems(n,this.arrayPath):0===m&&(m=1),h=0;h<m;h++)this.appendChild(this.childTemplate.clone());if(o.each(this.children,function(e){e.computeInitialValues(n,r)}),this.formElement&&this.formElement.valueInLegend)for(d=this;d;){if(d.parentNode&&d.parentNode.view&&d.parentNode.view.array&&(d.legendChild=this,d.formElement&&d.formElement.legend)){d.legend=o.applyArrayPath(d.formElement.legend,d.arrayPath),c.idx=d.arrayPath.length>0?d.arrayPath[d.arrayPath.length-1]+1:d.childPos+1,c.value=o.isSet(this.value)?this.value:"",d.legend=l.template(d.legend,o.valueTemplateSettings)(c);break}d=d.parentNode}},d.prototype.getPreviousNumberOfItems=function(e,t){var n=null,a=null,l=null;return e?this.view.inputfield&&this.schemaElement?(n=function(e,t){var n=0,i=0;if(!e)return null;if(t>0)for(;n<t;){if(-1===(i=e.indexOf("[]",i)))return e;i+=2,n+=1}return-1===(i=e.indexOf("[]",i))?e:e.substring(0,i)}(this.formElement.key,t.length),n=o.applyArrayPath(n,t),(a=s.util.getObjKey(e,n))?(l=i.map(this.children,function(n){return n.getPreviousNumberOfItems(e,t)}),o.max([o.max(l)||0,a.length])):0):this.view.array?this.childTemplate.getPreviousNumberOfItems(e,t):(l=i.map(this.children,function(n){return n.getPreviousNumberOfItems(e,t)}),o.max(l)||0):0},d.prototype.getFormValues=function(t){var n={};if(!this.el)throw new Error("formNode.getFormValues can only be called on nodes that are associated with a DOM element in the tree");var i=r(":input",this.el).serializeArray();i=i.concat(r(":input[type=checkbox]:not(:disabled):not(:checked)",this.el).map(function(){return{name:this.name,value:this.checked}}).get()),t&&o.each(i,function(e){e.name=o.applyArrayPath(e.name,t)});for(var a=this.ownerTree.formDesc.schema,l=0;l<i.length;l++){var d=i[l].name,m=o.getSchemaKey(a.properties,d),h=null,c=null;if(m)if(m._jsonform_checkboxes_as_array&&(h=d.match(/\[([0-9]*)\]$/)))d=d.replace(/\[([0-9]*)\]$/,""),c=s.util.getObjKey(n,d)||[],"1"===i[l].value&&c.push(m.enum[parseInt(h[1],10)]),s.util.setObjKey(n,d,c);else{if("boolean"===m.type&&("0"===i[l].value?i[l].value=!1:i[l].value=!!i[l].value),"number"!==m.type&&"integer"!==m.type||e.isString(i[l].value)&&(i[l].value.length?isNaN(Number(i[l].value))||(i[l].value=Number(i[l].value)):i[l].value=null),"string"!==m.type||""!==i[l].value||m._jsonform_allowEmpty||(i[l].value=null),"object"===m.type&&e.isString(i[l].value)&&"{"===i[l].value.substring(0,1))try{i[l].value=JSON.parse(i[l].value)}catch(e){i[l].value={}}"object"!==m.type||"null"!==i[l].value&&""!==i[l].value||(i[l].value=null),i[l].name&&null!==i[l].value&&s.util.setObjKey(n,i[l].name,i[l].value)}}return n},d.prototype.render=function(e){var t=this.generate();this.setContent(t,e),this.enhance()},d.prototype.setContent=function(e,t){var n=r(e),i=t||(this.parentNode?this.parentNode.el:this.ownerTree.domRoot),a=null;this.el?r(this.el).replaceWith(n):(a=r(i).children().get(this.childPos))?r(a).before(n):r(i).append(n),this.el=n,this.updateElement(this.el)},d.prototype.updateElement=function(e){this.id&&(this.el=r("#"+o.escapeSelector(this.id),e).get(0),this.view&&this.view.getElement&&(this.el=this.view.getElement(this.el)),!1!==this.fieldtemplate&&this.view&&this.view.fieldtemplate&&(this.el=r(this.el).parent().parent(),(this.prepend||this.prepend)&&(this.el=this.el.parent()),this.el=this.el.get(0)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(this.el=r(this.el).parent().get(0)));for(const t in this.children)0!=this.children.hasOwnProperty(t)&&this.children[t].updateElement(this.el||e)},d.prototype.generate=function(){var e={id:this.id,keydash:this.keydash,elt:this.formElement,schema:this.schemaElement,node:this,value:o.isSet(this.value)?this.value:"",escape:a.escapeHTML},t=null;this.ownerTree.formDesc.onBeforeRender&&this.ownerTree.formDesc.onBeforeRender(e,this),this.view.onBeforeRender&&this.view.onBeforeRender(e,this),t=this.template?this.template:this.formElement&&this.formElement.template?this.formElement.template:this.view.template,!1!==this.fieldtemplate&&(this.fieldtemplate||this.view.fieldtemplate)&&(t=s.fieldTemplate(t)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(t=this.parentNode.view.childTemplate(t,!o.isSet(this.parentNode.formElement.draggable)||this.parentNode.formElement.draggable));var n="";return o.each(this.children,function(e){n+=e.generate()}),e.children=n,e.fieldHtmlClass="",this.ownerTree&&this.ownerTree.formDesc&&this.ownerTree.formDesc.params&&this.ownerTree.formDesc.params.fieldHtmlClass&&(e.fieldHtmlClass=this.ownerTree.formDesc.params.fieldHtmlClass),this.formElement&&void 0!==this.formElement.fieldHtmlClass&&(e.fieldHtmlClass=this.formElement.fieldHtmlClass),l.template(t,o.fieldTemplateSettings)(e)},d.prototype.enhance=function(){var e=this,n=null,i=null,a=t.clone(this.ownerTree.formDesc.tpldata)||{};if(this.formElement&&(this.view.onInsert&&this.view.onInsert({target:r(this.el)},this),n=this.handlers||this.formElement.handlers,(i=this.onInsert||this.formElement.onInsert)&&i({target:r(this.el)},this),n&&o.each(n,function(e,t){"insert"===t&&e({target:r(this.el)},this)},this),this.el&&(this.onChange&&r(this.el).bind("change",function(t){e.onChange(t,e)}),this.view.onChange&&r(this.el).bind("change",function(t){e.view.onChange(t,e)}),this.formElement.onChange&&r(this.el).bind("change",function(t){e.formElement.onChange(t,e)}),this.onInput&&r(this.el).bind("input",function(t){e.onInput(t,e)}),this.view.onInput&&r(this.el).bind("input",function(t){e.view.onInput(t,e)}),this.formElement.onInput&&r(this.el).bind("input",function(t){e.formElement.onInput(t,e)}),this.onClick&&r(this.el).bind("click",function(t){e.onClick(t,e)}),this.view.onClick&&r(this.el).bind("click",function(t){e.view.onClick(t,e)}),this.formElement.onClick&&r(this.el).bind("click",function(t){e.formElement.onClick(t,e)}),this.onKeyUp&&r(this.el).bind("keyup",function(t){e.onKeyUp(t,e)}),this.view.onKeyUp&&r(this.el).bind("keyup",function(t){e.view.onKeyUp(t,e)}),this.formElement.onKeyUp&&r(this.el).bind("keyup",function(t){e.formElement.onKeyUp(t,e)}),n&&o.each(n,function(t,n){"insert"!==n&&r(this.el).bind(n,function(n){t(n,e)})},this)),this.legendChild&&this.legendChild.formElement)){var s=function(t){e.formElement&&e.formElement.legend&&e.parentNode&&(e.legend=o.applyArrayPath(e.formElement.legend,e.arrayPath),a.idx=e.arrayPath.length>0?e.arrayPath[e.arrayPath.length-1]+1:e.childPos+1,a.value=r(t.target).val(),e.legend=l.template(e.legend,o.valueTemplateSettings)(a),r(e.parentNode.el).trigger("legendUpdated"))};r(this.legendChild.el).bind("change",s),r(this.legendChild.el).bind("keyup",s)}o.each(this.children,function(e){e.enhance()})},d.prototype.insertArrayItem=function(e,t){var n=0;void 0===e&&(e=this.children.length);var i=this.childTemplate.clone();for(this.appendChild(i),i.resetValues(),n=this.children.length-2;n>=e;n--)this.children[n].moveValuesTo(this.children[n+1]);for(this.children[e].resetValues(),this.children[e].computeInitialValues(),n=e;n<this.children.length;n++)this.children[n].render(t)},d.prototype.deleteArrayItem=function(e){var t=0;for(void 0===e&&(e=this.children.length-1),t=e;t<this.children.length-1;t++)this.children[t+1].moveValuesTo(this.children[t]),this.children[t].render();this.removeChild()},d.prototype.getArrayBoundaries=function(){if(!this.view||!this.view.array)return{minItems:-1,maxItems:-1};var e=function(t,n){var i=null,a=null,l={minItems:-1,maxItems:-1};return n=n||t,t.view&&t.view.array&&t!==n?l:t.key?(a=t.key.replace(/\[[0-9]+\]/g,"[]"),t!==n&&(a=a.replace(/\[\][^\[\]]*$/,"")),(i=o.getSchemaKey(t.ownerTree.formDesc.schema.properties,a))?{minItems:i.minItems||i.minLength||-1,maxItems:i.maxItems||i.maxLength||-1}:l):(o.each(t.children,function(t){var i=e(t,n);-1!==i.minItems&&(-1!==l.minItems?l.minItems=Math.max(l.minItems,i.minItems):l.minItems=i.minItems),-1!==i.maxItems&&(-1!==l.maxItems?l.maxItems=Math.min(l.maxItems,i.maxItems):l.maxItems=i.maxItems)}),l)};return e(this)},s.formNode=d}),e("skylark-jsonform/form-tree",["skylark-langx-globals","skylark-langx-types","skylark-langx-objects","skylark-langx-arrays","skylark-langx-strings","skylark-jquery","./jsonform","./util","./element-types","./form-node"],function(e,t,n,i,a,l,r,s,o,d){var m=function(){this.eventhandlers=[],this.root=null,this.formDesc=null};return m.prototype.initialize=function(e){e=e||{},this.formDesc=n.clone(e),this.formDesc.prefix=this.formDesc.prefix||"jsonform-"+a.uniqueId(),this.formDesc.schema&&!this.formDesc.schema.properties&&(this.formDesc.schema={properties:this.formDesc.schema}),this.formDesc.form=this.formDesc.form||["*",{type:"actions",items:[{type:"submit",value:"Submit"}]}],this.formDesc.form=t.isArray(this.formDesc.form)?this.formDesc.form:[this.formDesc.form],this.formDesc.params=this.formDesc.params||{},this.root=new d,this.root.ownerTree=this,this.root.view=o.root,this.buildTree(),this.computeInitialValues()},m.prototype.buildTree=function(){s.each(this.formDesc.form,e=>{"*"===e?s.each(this.formDesc.schema.properties,(e,t)=>{this.root.appendChild(this.buildFromLayout({key:t}))}):(t.isString(e)&&(e={key:e}),this.root.appendChild(this.buildFromLayout(e)))},this)},m.prototype.buildFromLayout=function(e,a){var l=null,r=new d,m=null,h=null;if((e=n.clone(e)).items&&(t.isArray(e.items)?e.items=i.map(e.items,n.clone):e.items=[n.clone(e.items)]),e.key){if(!(l=s.getSchemaKey(this.formDesc.schema.properties,e.key)))throw new Error('The JSONForm object references the schema key "'+e.key+'" but that key does not exist in the JSON schema');if(this.formDesc.onElementSchema&&this.formDesc.onElementSchema(e,l),e.name=e.name||e.key,e.title=e.title||l.title,e.description=e.description||l.description,e.readOnly=e.readOnly||l.readOnly||e.readonly||l.readonly,e.id||(e.id=s.escapeSelector(this.formDesc.prefix)+"-elt-"+s.slugify(e.key)),e.allowEmpty&&(l._jsonform_allowEmpty=!0),!e.type){if(t.isArray(l.type)){if(i.contains(l.type,"null")&&(l.type=i.without(l.type,"null"),l.required=!1),l.type.length>1)throw new Error("Cannot process schema element with multiple types.");l.type=i.first(l.type)}"string"===l.type&&"color"===l.format?e.type="color":"number"!==l.type&&"integer"!==l.type||l.enum?"string"!==l.type&&"any"!==l.type||l.enum?"boolean"===l.type?e.type="checkbox":"object"===l.type?l.properties?e.type="fieldset":e.type="textarea":t.isUndefined(l.enum)?e.type=l.type:e.type="select":e.type="text":(e.type="number","number"===l.type&&(l.step="any"))}if(!e.options&&l.enum&&(e.titleMap?e.options=i.map(l.enum,function(t){return{value:t,title:s.hasOwnProperty(e.titleMap,t)?e.titleMap[t]:t}}):e.options=l.enum),"checkboxes"===e.type&&l.items){var c=l.items.enum;c&&(l.items._jsonform_checkboxes_as_array=!0),!c&&l.items[0]&&(c=l.items[0].enum)&&(l.items[0]._jsonform_checkboxes_as_array=!0)}"object"===l.type&&s.each(l.properties,(t,n)=>{r.appendChild(this.buildFromLayout({key:e.key+"."+n}))})}if(e.type||(e.type="none"),!(m=o[e.type]))throw new Error('The JSONForm contains an element whose type is unknown: "'+e.type+'"');if(l){if(!m.inputfield&&!m.array&&"selectfieldset"!==e.type&&"object"!==l.type)throw new Error('The JSONForm contains an element that links to an element in the JSON schema (key: "'+e.key+'") and that should not based on its type ("'+e.type+'")')}else if(m.inputfield&&"selectfieldset"!==e.type)throw new Error('The JSONForm defines an element of type "'+e.type+'" but no "key" property to link the input field to the JSON schema');return e.iddot=s.escapeSelector(e.id||""),r.formElement=e,r.schemaElement=l,r.view=m,r.ownerTree=this,e.handlers||(e.handlers={}),r.view.array?(h=e.items?e.items[0]||e.items:e.key+"[]",t.isString(h)&&(h={key:h}),r.setChildTemplate(this.buildFromLayout(h))):e.items&&s.each(e.items,e=>{t.isString(e)&&(e={key:e}),r.appendChild(this.buildFromLayout(e))}),r},m.prototype.computeInitialValues=function(){this.root.computeInitialValues(this.formDesc.value)},m.prototype.render=function(e){e&&(this.domRoot=e,this.root.render(),this.hasRequiredField()&&l(e).addClass("jsonform-hasrequired"))},m.prototype.forEachElement=function(e){var t=function(n){for(var i=0;i<n.children.length;i++)e(n.children[i]),t(n.children[i])};t(this.root)},m.prototype.validate=function(t){var n=r.getFormValue(this.domRoot),i=!1,a=this.formDesc;if(!1!==a.validate){var s=!1;if("object"!=typeof a.validate?e.JSONFormValidator&&(s=e.JSONFormValidator.createEnvironment("json-schema-draft-03")):s=a.validate,s){var o=s.validate(n,this.formDesc.schema);l(this.domRoot).jsonFormErrors(!1,a),o.errors.length&&(i||(i=[]),i=i.concat(o.errors))}}return i&&!t&&(a.displayErrors?a.displayErrors(i,this.domRoot):l(this.domRoot).jsonFormErrors(i,a)),{errors:i}},m.prototype.submit=function(e){var t=function(){return e&&(e.preventDefault(),e.stopPropagation()),!1},n=r.getFormValue(this.domRoot),i=this.formDesc,a=!1;if(this.forEachElement(function(t){a||t.view.onSubmit&&(a=!t.view.onSubmit(e,t))}),a)return t();var l=this.validate();return i.onSubmit&&!i.onSubmit(l.errors,n)?t():l.errors?t():!(!i.onSubmitValid||i.onSubmitValid(n))&&t()},m.prototype.hasRequiredField=function(){var e=function(n){if(!n)return null;if(n.required&&"boolean"!==n.type)return n;var a=i.find(n.properties,function(t){return e(t)});return a||(n.items&&(a=t.isArray(n.items)?i.find(n.items,function(t){return e(t)}):e(n.items))?a:void 0)};return e(this.formDesc.schema)},r.formTree=m}),e("skylark-jsonform/get-form-value",["skylark-jquery","./jsonform"],function(e,t){return t.getFormValue=function(t){var n=e(t).data("jsonform-tree");return n?n.root.getFormValues():null},t.getFormValue}),e("skylark-jsonform/fn",["skylark-langx","skylark-jquery","./form-tree","./get-form-value"],function(e,t,n,i){t.fn.jsonFormErrors=function(e,n){if(t(".error",this).removeClass("error"),t(".warning",this).removeClass("warning"),t(".jsonform-errortext",this).hide(),e){for(var i=[],a=0;a<e.length;a++){var l=e[a].uri.replace(/.*#\//,"").replace(/\//g,".").replace(/\.([0-9]+)(?=\.|$)/g,"[$1]"),r=".jsonform-error-"+util.escapeSelector(l.replace(/\./g,"---"));i.push(r);var s=e[a].type||"error";t(r,this).addClass(s),t(r+" .jsonform-errortext",this).html(e[a].message).show()}i=i.join(",");var o=t(i).get(0);o&&o.scrollIntoView&&o.scrollIntoView(!0,{behavior:"smooth"})}},t.fn.jsonForm=function(i){i=e.defaults({},i,{submitEvent:"submit"});var a,l,r,s,o=new n;return o.initialize(i),o.render(this.get(0)),i.transloadit&&this.append('<input type="hidden" name="params" value=\''+e.escapeHTML(JSON.stringify(i.transloadit.params))+"'>"),this.data("jsonform-tree",o),i.submitEvent&&(this.unbind(i.submitEvent+".jsonform"),this.bind(i.submitEvent+".jsonform",function(e){o.submit(e)})),a=function(e,t){t.find("> .active").removeClass("active"),e.addClass("active")},l=function(e,t){e.find("input, textarea, select").removeAttr("disabled"),e.parent().children(":not([data-idx="+t+"])").find("input, textarea, select").attr("disabled","disabled")},r=function(e){var n,i=t("option:selected",t(this)),r=t(this),s=i.get(0).getAttribute("data-idx")||i.attr("value");e.preventDefault(),i.hasClass("active")||(n=t(this).parents(".tabbable").eq(0).find("> .tab-content > [data-idx="+s+"]"),a(i,r),a(n,n.parent()),l(n,s))},s=function(e){t("a",t(this));var n=t(this).parents(".tabbable").first().find(".tab-content").first(),i=t(this).index(),r=n.find("> [data-idx="+i+"]");e.preventDefault(),a(t(this),t(this).parent()),a(r,r.parent()),t(this).parent().hasClass("jsonform-alternative")&&l(r,i)},this.each(function(){t(this).delegate("select.nav","change",r),t(this).find("select.nav").each(function(){t(this).val(t(this).find(".active").attr("value"));var e=t(this).find("option:selected").get(0).getAttribute("data-idx")||t(this).find("option:selected").attr("value"),n=t(this).parents(".tabbable").eq(0).find("> .tab-content > [data-idx="+e+"]");l(n,e)}),t(this).delegate("ul.nav li","click",s),t(this).find("ul.nav li.active").click()}),t(".expandable > div, .expandable > fieldset",this).hide(),this.on("click",".expandable > legend",function(){var e=t(this).parent();e.toggleClass("expanded"),e.find("legend").attr("aria-expanded",e.hasClass("expanded")),t("> div",e).slideToggle(100)}),o},t.fn.jsonFormValue=function(){return i(this)}}),e("skylark-jsonform/get-initial-value",["skylark-langx","./jsonform","./util"],function(e,t,n){var i=function(t,a,l,r,s){var o=null;(r=r||{}).idx=r.idx||(l?l[l.length-1]:1),r.value=n.isSet(r.value)?r.value:"",r.getValue=r.getValue||function(e){return i(t,e,l,r,s)};var d=function(t,i){var a=null;return t&&t.length?(n.each(t,function(t){a||(t!==i?e.isString(t)||(t.key===i?a=t:t.items&&(a=d(t.items,i))):a={key:t})}),a):null},m=d(t.form||[],a),h=n.getSchemaKey(t.schema.properties,a);return s&&t.value&&(o=n.getObjKey(t.value,n.applyArrayPath(a,l))),n.isSet(o)||(m&&void 0!==m.value?o=m.value:h&&n.isSet(h.default)&&(o=h.default),o&&-1!==o.indexOf("{{values.")&&(o=o.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}')),o&&(o=e.template(o,valueTemplateSettings)(r))),isSet(o)&&m&&n.hasOwnProperty(m.titleMap,o)&&(o=e.template(m.titleMap[o],valueTemplateSettings)(r)),o&&_.isString(o)&&h&&h.maxLength&&o.length>h.maxLength&&(o=o.substr(0,h.maxLength-1)+""),n.isSet(o)?o:null};return t.getInitialValue=i}),e("skylark-jsonform/main",["./jsonform","./element-types","./field-template","./fn","./form-node","./form-tree","./get-form-value","./get-initial-value","."],function(e){return e}),e("skylark-jsonform",["skylark-jsonform/main"],function(e){return e})}(n),!i){var r=require("skylark-langx-ns");a?module.exports=r:t.skylarkjs=r}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-jsonform.js.map
